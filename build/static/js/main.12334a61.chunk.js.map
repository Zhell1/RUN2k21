{"version":3,"sources":["ResponsiveDialog.js","getBsvPrice.js","checkOracleValue.js","copiedMessage.js","oracleCard.js","pursePayPresto.js","App.js","reportWebVitals.js","index.js"],"names":["ResponsiveDialog","props","React","useState","open","theme","useTheme","fullScreen","useMediaQuery","breakpoints","down","handleClose","Dialog","onClose","fullWidth","aria-labelledby","keepMounted","DialogContent","children","DialogActions","Button","onClick","color","autoFocus","get_bsvusd","a","bsvusd","fetch","method","then","response","json","p","ppi","l","TIMEOUT_MS","waitAndCheckValue","txid","callback_timeout","callback_successOracle","retry_every","timeout_ms","init_timestamp","Date","now","console","log","setTimeout","run","load","myRequest","sync","value","copyText","document","getElementById","select","setSelectionRange","execCommand","CopiedMessage","enqueueSnackbar","useSnackbar","handleClickVariant","variant","Fragment","size","useCardStyles","makeStyles","root","maxWidth","textAlign","margin","load_contract","origin","contract","OracleCard","classes","called_loadPrice","set_called_loadPrice","oracleRequestLocation","set_oracleRequestLocation","priceUSD","set_priceUSD","oracleValue","set_oracleValue","oracleOrigin","my_oracleRequest","oracle","location","my_oracle","loadPrice","isOpenPopup","set_isOpenPopup","isOpenPayPresto","set_isOpenPayPresto","handleOpenPayPresto","purse","set_prestoWidget","widgetname","successCallback","set_step","value2","step","oracleRequest","topay_usd","topay_satoshis","parseInt","tx","Run","Transaction","update","export","pay","loadPayPresto","requestId","price","Card","className","Typography","title","description","Alert","severity","LinearProgress","href","target","rel","type","id","style","opacity","maxSnack","language","a11yDark","wrapLongLines","Container","padding","textDecoration","class","CardActionArea","CardContent","gutterBottom","component","background","borderRadius","bsv","window","bsv1","pursePresto","this","rawtx","parents","utxos","i","inputs","length","push","prevTxId","toString","vout","outputIndex","satoshis","script","opreturn","Script","outputs","toASM","split","pushdata","decodeURIComponent","replace","data","to","Address","fromPublicKeyHash","fromBuffer","_scriptBuffer","getPublicKeyHash","Presto","create","key","mount","embed","on","payment","paid","forge","pop","forEach","utxo","addInput","build","signTxIn","keyPair","KeyPair","fromPrivKey","PrivKey","fromString","owner","privkey","signedrawtx","getRawTx","blockchain","broadcast","err","app","trust","App","display","AppBar","position","marginBottom","Toolbar","Grid","container","direction","justify","alignItems","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.12334a61.chunk.js","sourcesContent":["import React from \"react\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogContentText from \"@material-ui/core/DialogContentText\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport useMediaQuery from \"@material-ui/core/useMediaQuery\";\r\nimport { useTheme } from \"@material-ui/core/styles\";\r\n\r\nexport default function ResponsiveDialog(props) {\r\n    /**\r\n     *              open              boolean\r\n     * (optional)   handleClose       callback\r\n     */\r\n  const [open, setOpen] = React.useState(props.open) // false\r\n  const theme = useTheme();\r\n  const fullScreen = useMediaQuery(theme.breakpoints.down(\"sm\"));\r\n\r\n /* function handleClickOpen() {\r\n    setOpen(true);\r\n  }\r\n  */\r\n\r\n  function handleClose() {\r\n    if(props.handleClose) props.handleClose() // callback\r\n  }\r\n  \r\n\r\n  return (\r\n    <div>\r\n    {/*}\r\n      <Button variant=\"outlined\" color=\"primary\" onClick={handleClickOpen}>\r\n        Open responsive dialog\r\n      </Button>\r\n    */}\r\n    <Dialog\r\n        fullScreen={fullScreen}\r\n        open={props.open}\r\n        onClose={handleClose}\r\n        fullWidth={true}\r\n        aria-labelledby=\"responsive-dialog-title\"\r\n        keepMounted={true} // keep mounted otherwise paypresto can't inject in it \r\n      >\r\n        <DialogContent>\r\n          {props.children}\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={handleClose} color=\"primary\" autoFocus>\r\n            Close\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n}\r\n","import fetch from \"node-fetch\"\r\n\r\nexport async function get_bsvusd(){\r\n    let bsvusd = 170 // default value\r\n    //take the value of BSV from preev API\r\n    await fetch(\"https://api.preev.pro/v1/tickers/12eLTxv1vyUeJtp5zqWbqpdWvfLdZ7dGf8\",{ \r\n      method: 'GET'\r\n    })\r\n    .then((response) => { return response.json(); })\r\n    .then((json)  => {\r\n      bsvusd = json.p.ppi.l\r\n    })\r\n    return bsvusd\r\n}\r\n\r\n/*function keepLastTwoNonZeroValues(floatPrice){\r\n  let strDecimals = String(floatPrice).split('.')[1]\r\n  if (!strDecimals) {\r\n  \treturn parseFloat(floatPrice)\r\n  }\r\n  let nbdec = 0\r\n  let nbNonZerofound = 0\r\n  for(let i=0; i<strDecimals.length && nbNonZerofound<2; i++){\r\n    if(strDecimals[i] != \"0\"){\r\n      nbNonZerofound++\r\n    }\r\n    nbdec++\r\n  }\r\n  return parseFloat(floatPrice).toFixed(nbdec)\r\n}*/\r\n\r\n/*function satsToUsd(satoshis){\r\n  return keepLastTwoNonZeroValues(satoshis*bsvusd*1e-8)\r\n}*/\r\n","import { run } from \"./App.js\"\r\n\r\nexport const TIMEOUT_MS = 20*1000 // for value set() by oracle\r\n\r\nexport async function waitAndCheckValue(txid, callback_timeout, callback_successOracle, retry_every=200, timeout_ms=TIMEOUT_MS, init_timestamp=null){\r\n\r\n    if(!init_timestamp){\r\n      init_timestamp = Date.now()\r\n      console.log(\"set timestamp at \",init_timestamp)\r\n    }\r\n  \r\n      setTimeout(async ()=>{\r\n        // run.sync and check .value != undefined\r\n      var myRequest = await run.load(txid+'_o1') // TODO make that better\r\n      await myRequest.sync()\r\n      var value = myRequest.value\r\n      \r\n      if(value){\r\n        console.log(\"success with value: myRequest=\",myRequest,\" \\n\\n value = \",value)\r\n        \r\n        callback_successOracle(value, txid)\r\n  \r\n      } else {\r\n          if(Date.now()-init_timestamp > timeout_ms) {\r\n          console.log(\"timedout at \",Date.now())\r\n          callback_timeout()\r\n        } else {\r\n                  waitAndCheckValue(txid, callback_timeout, callback_successOracle, retry_every, timeout_ms, init_timestamp)\r\n        }\r\n      }\r\n      }, retry_every)\r\n  }","import React from 'react';\r\nimport './App.css';\r\nimport { Button } from '@material-ui/core';\r\nimport FileCopyIcon from '@material-ui/icons/FileCopy';\r\nimport { useSnackbar } from 'notistack';\r\n\r\nfunction copyText() {\r\n    /* Get the text field */\r\n    var copyText = document.getElementById(\"textToCopy\");\r\n  \r\n    /* Select the text field */\r\n    copyText.select();\r\n    copyText.setSelectionRange(0, 99999); /* For mobile devices */\r\n  \r\n    /* Copy the text inside the text field */\r\n    document.execCommand(\"copy\");\r\n}\r\n\r\nexport function CopiedMessage() {\r\n    const { enqueueSnackbar } = useSnackbar();\r\n  \r\n    const handleClickVariant = (variant) => () => {\r\n      // variant could be success, error, warning, info, or default\r\n      enqueueSnackbar('Copied message!', { variant });\r\n    };\r\n  \r\n    function clickCopy(){\r\n      copyText()\r\n      handleClickVariant('success')\r\n    }\r\n  \r\n    return (\r\n      <React.Fragment>\r\n        <span onClick={copyText}>\r\n          <Button variant=\"outlined\" size=\"small\" onClick={handleClickVariant('success')}>\r\n            <FileCopyIcon size=\"small\" color=\"primary\"/>\r\n            &nbsp; Copy origin\r\n          </Button>\r\n        </span>\r\n      </React.Fragment>\r\n    );\r\n  }","import React, { useState } from 'react';\r\nimport { Button, Container } from '@material-ui/core';\r\nimport ResponsiveDialog from \"./ResponsiveDialog\";\r\nimport Card from '@material-ui/core/Card';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport CardActionArea from '@material-ui/core/CardActionArea';\r\nimport CardContent from '@material-ui/core/CardContent';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport SyntaxHighlighter from 'react-syntax-highlighter';\r\nimport { a11yDark } from 'react-syntax-highlighter/dist/esm/styles/hljs';\r\nimport Alert from '@material-ui/lab/Alert';\r\nimport LinearProgress from '@material-ui/core/LinearProgress';\r\nimport { SnackbarProvider } from 'notistack';\r\nimport Run from \"run-sdk\";\r\n\r\nimport { get_bsvusd } from \"./getBsvPrice.js\"\r\nimport { waitAndCheckValue, TIMEOUT_MS } from \"./checkOracleValue.js\"\r\nimport { CopiedMessage } from \"./copiedMessage.js\"\r\n\r\n\r\nimport { run } from \"./App.js\"\r\n\r\nconst useCardStyles = makeStyles({\r\n    root: {\r\n      maxWidth: 300,\r\n      textAlign: 'left',\r\n      margin: \"20px\",\r\n    }\r\n});\r\n\r\nconst exampleOfUse =\r\n`class MysteriousEgg extends Jig\r\n{ \r\n  init(){ \r\n    this.randomValue = new RandomValue()\r\n  }\r\n  hatch(){\r\n    let x = this.randomValue.value\r\n    // rarity between 1-99 but we make it super rare to get one near 100\r\n    this.rarity = parseInt(power(100,x*x*x), 10)\r\n  }\r\n}\r\nMysteriousEgg.deps = { RandomValue, power }\r\n\r\n// TimestampRequest idea => make an egg that can only be hatched on full moon\r\n`\r\n\r\nfunction createLink(requestId){\r\n    return \"https://run.network/explorer/?query=\"+requestId+\"&network=main\"\r\n  }\r\n\r\nasync function load_contract(origin){\r\n    // load oracleRequests contracts\r\n    let contract = await run.load(origin)\r\n    await contract.sync()\r\n    await run.sync()\r\n    console.log(\"load_contracts(): contract = \",contract,\"for\",origin)\r\n    return contract\r\n}\r\n\r\nexport function OracleCard(props) {\r\n    /**\r\n     *  title, description, widgetname, oracleOrigin\r\n     */\r\n    const classes = useCardStyles();\r\n  \r\n    const [called_loadPrice, set_called_loadPrice] = useState(false)\r\n    const [oracleRequestLocation, set_oracleRequestLocation] = useState(null)\r\n    //const [satoshisPerCall, set_satoshisPerCall] = useState(\"loading\")\r\n    const [priceUSD, set_priceUSD] = useState(null)\r\n    const [oracleValue, set_oracleValue] = useState()\r\n  \r\n    async function loadPrice(){\r\n  \r\n      if(!props.oracleOrigin) return\r\n  \r\n      let my_oracleRequest = await load_contract(props.oracleOrigin) // load & sync\r\n  \r\n      console.log(\"my_oracleRequest = \",my_oracleRequest)\r\n      console.log(\"my_oracleRequest.oracle = \",my_oracleRequest.oracle)\r\n  \r\n      \r\n      set_oracleRequestLocation(my_oracleRequest.location)\r\n  \r\n      let my_oracle = my_oracleRequest.oracle\r\n      console.log(\"my_oracle 1 = \",my_oracle)\r\n      await my_oracle.sync()\r\n      console.log(\"my_oracle 2 = \",my_oracle)\r\n      set_priceUSD(my_oracle.priceUSD)\r\n      //let satoshis = my_oracle.satoshisPerCall\r\n      //set_satoshisPerCall(satoshis)\r\n    }\r\n  \r\n    if(!called_loadPrice){\r\n      set_called_loadPrice(true)\r\n      loadPrice()\r\n      // TODO there is probably a cleaner way to do this\r\n    }\r\n  \r\n  \r\n    const [isOpenPopup, set_isOpenPopup] = useState(false)\r\n    const handleClosedPopup = () => {\r\n      set_isOpenPopup(false)\r\n    }\r\n    const handleOpenPopup = () => {\r\n      set_isOpenPopup(true)\r\n    }\r\n  \r\n    // Paypresto popup\r\n    const [isOpenPayPresto, set_isOpenPayPresto] = useState(false)\r\n    const handleClosedPayPresto = () => {\r\n      set_isOpenPayPresto(false)\r\n    }\r\n    const handleOpenPayPresto = async () => {\r\n      \r\n      set_isOpenPayPresto(true)\r\n  \r\n      run.purse.set_prestoWidget(props.widgetname, successCallback)\r\n  \r\n      set_step(\"clicked\")\r\n    }\r\n  \r\n    function callback_timeout(){\r\n      set_step(\"timedout\")\r\n    }\r\n  \r\n    async function callback_successOracle(value, txid)\r\n    {\r\n      var myRequest = await run.load(txid+'_o1') // TODO make that better\r\n      await myRequest.sync()\r\n      set_oracleValue(myRequest.value)\r\n      var value2 = myRequest.value\r\n      set_step(\"response\")\r\n      console.log(\"callback_successOracle(): value=\",value,\" & value2=\",value2)\r\n    }\r\n  \r\n    function successCallback(txid){ // success payment\r\n      console.log(\"successCallback!! txid=\",txid)\r\n      set_step(\"paid\")\r\n      set_isOpenPayPresto(false)\r\n      \r\n      waitAndCheckValue(txid, callback_timeout, callback_successOracle)\r\n    }\r\n  \r\n    const [step, set_step] = useState(\"init\") // init, clicked, ready, paid, response, timedout\r\n  \r\n  \r\n    async function loadPayPresto(){\r\n  \r\n      // RUN tx oracle request\r\n  \r\n      if(!oracleRequestLocation) return\r\n      var oracleRequest = await load_contract(oracleRequestLocation)\r\n  \r\n      // resync for safety\r\n      await oracleRequest.sync()\r\n      await run.sync()\r\n      //\r\n      let my_oracle = oracleRequest.oracle\r\n      console.log(\"my_oracle 1 = \",my_oracle)\r\n      await my_oracle.sync()\r\n      //\r\n      let topay_usd = my_oracle.priceUSD\r\n      let bsvusd = await get_bsvusd()\r\n      let topay_satoshis = parseInt(topay_usd / bsvusd * 1e8,10)\r\n      //\r\n      const tx = new Run.Transaction()\r\n      var myRequest\r\n      tx.update(()=>{\r\n        myRequest = new oracleRequest(topay_satoshis)\r\n      })\r\n      const rawtx = await tx.export({pay: true})\r\n  \r\n      console.log(\"handleOpenPayPresto(): myRequest = \",myRequest)\r\n      //pay(props.widgetname, successCallback) // old\r\n    }\r\n  \r\n    if(step==\"clicked\")\r\n    {\r\n      set_step(\"ready\")\r\n      loadPayPresto()\r\n    }\r\n  \r\n    //var price = (satoshisPerCall==\"loading\"?\"loading\":\"$\"+satsToUsd(satoshisPerCall))\r\n    var price = priceUSD?\"$\"+priceUSD:\"loading\"\r\n  \r\n    return(\r\n      <Card className={classes.root} >\r\n  \r\n          <ResponsiveDialog open={isOpenPopup} handleClose={handleClosedPopup}>\r\n              <Typography variant=\"h5\">\r\n                {props.title}\r\n              </Typography> \r\n             <br/>\r\n             {props.description} \r\n             <br/>\r\n             <br/>\r\n             Price {price}/call <br/><br/>\r\n  \r\n            {step==\"init\"?\r\n                <Button variant=\"contained\" color=\"primary\"\r\n                  onClick={handleOpenPayPresto}>\r\n                  TEST ORACLE\r\n                </Button>\r\n            :step==\"paid\"?\r\n              <div>\r\n                <Alert severity=\"info\">Sent, waiting for Oracle now... </Alert>\r\n                <LinearProgress />\r\n              </div>\r\n            :step==\"response\"?\r\n              <div>\r\n                <Alert severity=\"success\">Oracle responded with value: {oracleValue}</Alert>\r\n              </div>\r\n            :step==\"timedout\"?\r\n              <div>\r\n                <Alert severity=\"warning\">Request timed out after {parseInt(TIMEOUT_MS/1000, 10)} seconds, try again or contact admin.</Alert>\r\n              </div>\r\n            :\r\n              <Button variant=\"contained\" color=\"primary\"\r\n                onClick={handleOpenPayPresto}>\r\n                TEST ORACLE\r\n              </Button> \r\n            }\r\n  \r\n            <br/><br/>\r\n            Origin: \r\n            <br/>\r\n            <a href={createLink(props.oracleOrigin)} target=\"_blank\" rel=\"noopener noreferrer\">\r\n              {props.oracleOrigin}\r\n            </a>\r\n            <input type=\"text\" value={props.oracleOrigin} id =\"textToCopy\" style={{opacity:\"0\"}}></input>\r\n            <br/>\r\n            <SnackbarProvider maxSnack={3}>\r\n              <CopiedMessage/>\r\n            </SnackbarProvider>\r\n            <br/><br/>\r\n            \r\n            Example of use:\r\n            <br/>\r\n            <SyntaxHighlighter language=\"javascript\" style={a11yDark} wrapLongLines=\"true\">\r\n              {exampleOfUse}\r\n            </SyntaxHighlighter>\r\n            <Container style={{padding: \"0px 178px\"}}>\r\n              <a href=\"https://github.com/Zhell1/RUN2k21\" style={{textDecoration: \"none\"}} target=\"_blank\" rel=\"noopener noreferrer\"><Button variant=\"contained\">See more on GitHub</Button></a>\r\n            </Container>\r\n            <ResponsiveDialog open={isOpenPayPresto} handleClose={handleClosedPayPresto}>\r\n              <div id={props.widgetname} class={props.widgetname}></div>\r\n            </ResponsiveDialog>\r\n  \r\n          </ResponsiveDialog>\r\n  \r\n  \r\n        <CardActionArea onClick={handleOpenPopup}>\r\n          <CardContent>\r\n            <Typography gutterBottom variant=\"h5\" component=\"h2\">\r\n              {props.title}\r\n            </Typography>\r\n            <Typography variant=\"body2\" color=\"textSecondary\" component=\"p\">\r\n              {props.description}\r\n            </Typography>\r\n            <br/>\r\n            <Typography variant=\"body2\" color=\"textSecondary\" component=\"p\">\r\n              <span style={{background: \"#3f51b5\", borderRadius: \"4px\", color: \"white\", padding: \"3px\"}}>\r\n                {price}\r\n              </span>\r\n            </Typography>\r\n          </CardContent>\r\n        </CardActionArea>\r\n      </Card>\r\n    )\r\n  }","import {Presto, embed} from 'paypresto.js';\r\n\r\nimport {run} from \"./App.js\"\r\n\r\nconst bsv = window.bsv1\r\n\r\nexport class pursePayPresto\r\n{\r\n    set_prestoWidget(widgetname, successCallback)\r\n    {\r\n      this.widgetname=widgetname\r\n      this.successCallback=successCallback\r\n    }\r\n    async pay(rawtx, parents) {\r\n        // process the raw transaction, outputs and UTXOs\r\n        const tx = new bsv.Transaction(rawtx)\r\n        let utxos = []\r\n        for(let i=0; i<tx.inputs.length; i++){\r\n          utxos.push({\r\n            txid: tx.inputs[i].prevTxId.toString('hex'),\r\n            vout: tx.inputs[i].outputIndex,\r\n            satoshis: parents[i].satoshis,\r\n            script: parents[i].script,\r\n          })\r\n        }\r\n        let opreturn = bsv.Script(tx.outputs[0].script).toASM().split(' ')\r\n        let pushdata = []\r\n        for(let i=2; i<opreturn.length; i++){\r\n          pushdata.push(decodeURIComponent(opreturn[i].replace(/\\s+/g, '').replace(/[0-9a-f]{2}/g, '%$&')))\r\n        }\r\n        let outputs = [{data: pushdata}]\r\n        for (let i=1; i<tx.outputs.length; i++){\r\n          outputs.push({\r\n            satoshis: tx.outputs[i].satoshis,\r\n            to: bsv.Address.fromPublicKeyHash(new bsv.Script.fromBuffer(tx.outputs[i]._scriptBuffer).getPublicKeyHash()).toString()\r\n          })\r\n        }\r\n    var payment = Presto.create({\r\n      key: 'Kx2p4o7FYJYjEwufdYJLXjPtu2vaSpQ8mB7mjMJnaHnPSrGQ1nQk', //  ephemeral private key for 1st tx\r\n      description: 'RUN2K21_Hackaton_RunCraft',\r\n      outputs: outputs,\r\n    })\r\n    payment.mount( embed('#'+this.widgetname, { style: ['rounded', 'border-thick'] }) )\r\n    .on('funded', async(payment) => {\r\n        const paid = payment.forge.inputs.pop()\r\n        utxos.forEach(utxo => payment.forge.addInput(utxo))\r\n        payment.forge.inputs.push(paid)\r\n        payment.forge.build()\r\n        for(let i=0; i<payment.forge.inputs.length-1; i++){\r\n          payment.signTxIn(i, {keyPair: new bsv.KeyPair().fromPrivKey(new bsv.PrivKey().fromString(run.owner.privkey))})\r\n        }\r\n        payment.signTxIn(payment.forge.inputs.length-1, {keyPair: payment.keyPair})\r\n        const signedrawtx = payment.getRawTx()\r\n        let tx = await run.blockchain.broadcast(signedrawtx)\r\n        console.log('TX sent', tx)\r\n        this.successCallback(tx)\r\n    })\r\n    .on('error', err => {\r\n      console.log('Error: ', err)\r\n    })\r\n  }\r\n}","import React from 'react';\r\nimport './App.css';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport AppBar from '@material-ui/core/AppBar';\r\nimport Toolbar from '@material-ui/core/Toolbar';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Run from \"run-sdk\";\r\n\r\nimport { OracleCard } from \"./oracleCard.js\"\r\nimport { pursePayPresto } from \"./pursePayPresto.js\"\r\n\r\nconst RandomValueRequest_origin = \"c968fc2674921d07c39051fa735e6a5ebbb69cc0b8b90232e76ae87e3d72101a_o2\"\r\nconst BSVUSDRequest_origin \t\t\t= \"c1f16893516de7824af5984aa343ce4df42d38b238b8b1dced2b1d3abb44361c_o2\"\r\nconst TimestampRequest_origin\t \t= \"fcbf7ad48704593f46c1d357d0d6913f442fc244c58c2ef0fef78cb15a5dac7e_o2\"\r\n\r\nconst pursePresto = new pursePayPresto()\r\n\r\nexport const run = new Run({\r\n  purse: pursePresto,\r\n  app: \"RUN2K2021_Hackaton_RunCraft\",\r\n  trust: \"*\"\r\n})\r\n\r\nfunction App() {\r\n  return (\r\n    <div className=\"App\">\r\n      <header className=\"App-header\" style={{display: 'block'}}>\r\n        <AppBar position=\"static\" style={{marginBottom: \"2em\"}}>\r\n          <Toolbar>\r\n            <Typography variant=\"h5\">\r\n              Oracles\r\n            </Typography>\r\n          </Toolbar>\r\n        </AppBar>\r\n\r\n        <Grid container direction=\"row\" justify=\"space-evenly\" alignItems=\"flex-start\">\r\n          <OracleCard title=\"Random Value Oracle\" description=\"This Oracle gives you a random value as a float between 0 and 1, same as Math.random() but for jigs.\" widgetname=\"oracle1\" oracleOrigin={RandomValueRequest_origin}/>\r\n          <OracleCard title=\"BSV/USD Price Oracle\" description=\"This Oracle gives you the current BSV price in USD\" price={0.01} widgetname=\"oracle2\" oracleOrigin={BSVUSDRequest_origin}/>\r\n          <OracleCard title=\"Timestamp Oracle\" description=\"This Oracle gives you the current timestamp in ms, same as Date.now() but for jigs.\" price={0.01} widgetname=\"oracle3\" oracleOrigin={TimestampRequest_origin}/>\r\n        </Grid>\r\n      </header>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","const reportWebVitals = onPerfEntry => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}